<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.itkey.QuestionMapper">

	<!-- 회원 문의 조회 -->
	<select id="selectAsk"  parameterType="string" resultType="Question">
		select
		ask_no,phone,ask_title,ask_content,reply_yn,ask_category,ans_content
		,date_format(ask_date,'%Y-%m-%d')as ask_date
		from question_tbl left outer join answer_tbl using(ask_no) 
		where phone=#{phone}
		order by ask_no desc
	</select>

	<!-- 문의하기 본인글쓰기 -->
	<insert id="insertAsk" parameterType="Question">
		insert into
		question_tbl(phone,ask_title,ask_category,ask_content,ask_date
		)values(
		#{phone},#{asktitle},#{askcategory},#{askcontent},now()
		)
	</insert>

	<!-- 문의글 삭제 -->
	<delete id="deleteAsk" parameterType="_int">
		delete from question_tbl
		where ask_no=#{askno}
	</delete>
	
	<!-- 문의글 수정 -->
	<update id="updateAsk" parameterType="_int">
		update question_tbl set
		reply_yn ='Y'
		where ask_no = #{askno}
	</update>

	<!-- 문의하기 전체 조회 -->
	<select id="selectAskList" resultType="Question">
		select
		ask_no,phone,ask_title,ask_content,reply_yn,ask_category,ans_content,date_format(ask_date,'%Y-%m-%d')as
		ask_date
		from question_tbl
		order by ask_no desc
	</select>

	<!-- 문의하기 Y -->
	<select id="selectAskY" resultType="Question">
		select
		ask_no,phone,ask_title,ask_content,reply_yn,ask_category,ans_content
		,date_format(ask_date,'%Y-%m-%d')as ask_date
		from question_tbl
		from question_tbl left outer join answer_tbl using(ask_no) 
		where reply_yn = 'Y'
		order by ask_no desc
	</select>
	<!-- 문의하기 N -->
	<select id="selectAskN" resultType="Question">
		select
		ask_no,phone,ask_title,ask_content,reply_yn,ask_category,ans_content
		,date_format(ask_date,'%Y-%m-%d')as ask_date
		from question_tbl
		where reply_yn = 'N'
		order by ask_no desc
	</select>
	
	<select id="selectAsk2" parameterType="_int"
		resultType="Question">
		select
		ask_no,phone,ask_title,ask_content,reply_yn,ask_category,ans_content
		,date_format(ask_date,'%Y-%m-%d')as ask_date
		from question_tbl
		where ask_no=#{askno}
		order by ask_no desc
	</select>
	
</mapper>